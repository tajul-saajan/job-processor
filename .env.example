# ============================================================
# POSTGRESQL CONFIGURATION (for Docker Compose)
# ============================================================

# PostgreSQL credentials
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=job-processor
POSTGRES_PORT=5432

# Database connection URL (REQUIRED)
# Format: postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE_NAME
# For Docker: use service name 'postgres' as host
# For local: use 'localhost' as host
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/job-processor

# ============================================================
# DATABASE CONNECTION POOL
# ============================================================

# Maximum number of database connections in the pool (OPTIONAL)
# Default: 15
# Formula: NUM_WORKERS + MAX_CONCURRENT_JOBS + API_BUFFER (typically 5-7)
# Example: 3 workers + 5 jobs + 7 API buffer = 15
# Increase for high-traffic production environments
MAX_DB_CONNECTIONS=15

# ============================================================
# WORKER CONFIGURATION
# ============================================================

# Maximum number of jobs processing concurrently (OPTIONAL)
# Default: 5
# This is the semaphore permit count - controls parallel job execution
# Higher = more throughput but uses more CPU/memory/DB connections
# Recommended: 3-10 for most workloads
MAX_CONCURRENT_JOBS=5

# Number of worker loops acquiring jobs from queue (OPTIONAL)
# Default: 3
# Workers continuously fetch jobs and spawn processing tasks
# Should be less than MAX_CONCURRENT_JOBS (typically half)
# Recommended: 2-5 for most workloads
NUM_WORKERS=3

# IMPORTANT: Ensure MAX_DB_CONNECTIONS >= NUM_WORKERS + MAX_CONCURRENT_JOBS + 5

# ============================================================
# HTTP CONFIGURATION
# ============================================================

# Maximum payload size for all requests in bytes (OPTIONAL)
# Default: 10485760 (10MB)
# Protects against memory exhaustion attacks
# Increase if you need to handle larger file uploads
MAX_PAYLOAD_SIZE=10485760

# ============================================================
# LOGGING
# ============================================================

# Log directory for file-based logging with daily rotation (OPTIONAL)
# Default: logs
# Logs are automatically separated by level:
#   - logs/info.log.2024-12-22
#   - logs/warn.log.2024-12-22
#   - logs/error.log.2024-12-22
#   - logs/debug.log.2024-12-22
# New files are created daily with automatic rotation
LOG_DIR=logs

# Logging level (OPTIONAL)
# Options: error, warn, info, debug, trace
# Default: info
# Example for debug level: RUST_LOG=debug
# Example for specific module: RUST_LOG=job_processor=debug,sqlx=warn
# RUST_LOG=info

# ============================================================
# DEPLOYMENT EXAMPLES
# ============================================================

# Development (Low Load):
# MAX_DB_CONNECTIONS=10
# MAX_CONCURRENT_JOBS=3
# NUM_WORKERS=2

# Production Balanced (Recommended):
# MAX_DB_CONNECTIONS=15
# MAX_CONCURRENT_JOBS=5
# NUM_WORKERS=3

# High Throughput:
# MAX_DB_CONNECTIONS=25
# MAX_CONCURRENT_JOBS=10
# NUM_WORKERS=5

# CPU-Bound Jobs:
# MAX_DB_CONNECTIONS=15
# MAX_CONCURRENT_JOBS=4  # Match CPU cores
# NUM_WORKERS=2

# I/O-Bound Jobs:
# MAX_DB_CONNECTIONS=35
# MAX_CONCURRENT_JOBS=20
# NUM_WORKERS=5
